{% extends "global/Page.html" %}
{% load otree static %}

{% block scripts %}

{% endblock %}

{% block styles %}
    <link href="{% static 'ReputationCosts/custom.css' %}" rel="stylesheet"/>
    <link href="{% static 'ReputationCosts/table.css' %}" rel="stylesheet"/>
    <link href="{% static 'ReputationCosts/popup.css' %}" rel="stylesheet"/>
    <link href="{% static 'ReputationCosts/table_PopUp.css' %}" rel="stylesheet"/>

{% endblock %}

{% block title %}
Handelsphase - Periode {{ subsession.round_number }}
{% endblock %}

{% block content %}

{% if player.rand == 1 %}

    <div class="container-fluid">
        <div class="row toprow">
            <div class="col-md-4">
                <div class="card my-0">
                    <div class="card-body" style="height: 816px;">
                        {% include 'RepCostExperiment/comp_template/A.html' %}
                            <p>
                                <table align="center" style="width: 378px" >
                                    <tr style="font-size:10pt;">
                                        <th>Letzter Marktpreis A-Unternehmen </th>
                                    </tr>
                                    <tr style="background: whitesmoke; font-size:10pt;">
                                        <td style="text-align:center" width="350px">{% if subsession.round_number == 1 %}Noch kein Handel {% else %}{% if marktpreisA_alt == None %}Kein Handel{% else %}{{ marktpreisA_alt }}{% endif %}{% endif %}</td>
                                    </tr>
                                </table>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card my-0" >
                    <div class="card-body"  style="height: 276px">
                        <h4 class="card-title" align="center" style="margin-bottom: .0rem">
                           Informationen
                        </h4>
                        <div id="Info" style=" float:left;">
                            <p>
                                <table align="center" style="width: 378px" >
                                    <tr style="font-size:10pt;">
                                        <th>Ihr Vermögen </th>
                                    </tr>
                                    <tr style="font-size:10pt;">
                                        <td style="text-align:center" width="350px">{{ player.endowment }}</td>
                                    </tr>
                                </table>
                            </p>

                            <p>
                                <table align="center" style="width: 378px" >
                                    <tr style="font-size:10pt;">
                                        <th colspan="2">Ihr Portfolio </th>
                                    </tr>
                                    <tr style="font-size:10pt;">
                                        <td style="text-align:center" width="175px">Anzahl A-Aktien</td> <td style="text-align:center" width="175px">Anzahl B-Aktien</td>
                                    </tr>
                                    <tr style="background: whitesmoke; font-size:10pt;">
                                        <td style="text-align:center" width="175px">{{ player.anzahlA }}</td> <td style="text-align:center" width="175">{{ player.anzahlB }}</td>
                                    </tr>
                                </table>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="card my-0" style="top: 20px; height: 520px" >
                    <div class="card-body"  style="height: 500px">
                        <h4 class="card-title" align="center" style="margin-bottom: .0rem">
                               Ihre Entscheidung
                        </h4>
                        <div id="Info2" style=" float:left;">
                            <div class="alert alert-info" role="alert" style="text-align: center;text-justify: inherit">
                                    Geben Sie hier Ihre Verkaufs- und Kaufpreise ein:
                            </div>
                                <div id="main" style="margin-left: -10px;">
                                    <div id="spaltelinks">
                                        <div class="card my-4" >
                                            <div class="card-body" style="height: 250px;" >
                                                <h4 class="card-title">
                                                    A-Unternehnem
                                                </h4>
                                                <table border="0" cellpadding="1" cellspacing="1">
                                                    <tr style="font-size:10pt;">
                                                        <td>{% formfield player.verkaufA label="Verkauf A:" %}</td>
                                                    </tr>
                                                    <tr style="font-size:10pt;">
                                                        <td>{% formfield player.kaufA label="Kauf A:"%}</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <div id="spalterechts">
                                        <div class="card my-4">
                                            <div class="card-body" style="height: 250px;">
                                                <h4 class="card-title">
                                                    B-Unternehmen
                                                </h4>
                                                <table border="0" cellpadding="1" cellspacing="1">
                                                    <tr style="font-size:10pt;">
                                                        <td>{% formfield player.verkaufB  label="Verkauf B:"%}</td>
                                                    </tr>
                                                    <tr style="font-size:10pt;">
                                                        <td>{% formfield player.kaufB label="Kauf B:"%}</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="clear"></div>
                                </div>
                        </div>
                    </div>

                    {% next_button %}
                </div>
            </div>


            <div class="col-md-4">
                <div class="card my-0">
                    <div class="card-body" style="height: 816px;">
                        {% include 'RepCostExperiment/comp_template/B.html' %}
                            <br>
                            <br>
                                <p>
                                    <table align="center" style="width: 378px">
                                        <tr style="font-size:10pt;">
                                            <th>Letzter Marktpreis B-Unternehmen</th>
                                        </tr>
                                        <tr style="background: whitesmoke; font-size:10pt;">
                                            <td style="text-align:center" width="350px">{% if subsession.round_number == 1 %}Noch kein Handel {% else %}{% if marktpreisB_alt == None %}Kein Handel{% else %}{{ marktpreisB_alt }}{% endif %}{% endif %}</td>
                                        </tr>
                                    </table>
                                </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% else %}

    <div class="container-fluid">
        <div class="row toprow">
            <div class="col-md-4">
                <div class="card my-0">
                    <div class="card-body" style="height: 816px;">
                        {% include 'RepCostExperiment/comp_template/A.html' %}
                            <br>
                            <br>
                                <p>
                                    <table align="center" style="width: 378px">
                                        <tr style="font-size:10pt;">
                                            <th>Letzter Marktpreis A-Unternehmen</th>
                                        </tr>
                                        <tr style="background: whitesmoke; font-size:10pt;">
                                            <td style="text-align:center" width="350px">{% if subsession.round_number == 1 %}Noch kein Handel {% else %}{% if marktpreisB_alt == None %}Kein Handel{% else %}{{ marktpreisB_alt }}{% endif %}{% endif %}</td>
                                        </tr>
                                    </table>
                                </p>
                        </div>
                    </div>
                </div>
            </div>



            <div class="col-md-4">
                <div class="card my-0" >
                    <div class="card-body"  style="height: 276px">
                        <h4 class="card-title" align="center" style="margin-bottom: .0rem">
                           Informationen
                        </h4>
                        <div id="Info" style=" float:left;">
                            <p>
                                <table align="center" style="width: 378px" >
                                    <tr style="font-size:10pt;">
                                        <th>Ihr Vermögen </th>
                                    </tr>
                                    <tr style="font-size:10pt;">
                                        <td style="text-align:center" width="350px">{{ player.endowment }}</td>
                                    </tr>
                                </table>
                            </p>

                            <p>
                                <table align="center" style="width: 378px" >
                                    <tr style="font-size:10pt;">
                                        <th colspan="2">Ihr Portfolio </th>
                                    </tr>
                                    <tr style="font-size:10pt;">
                                        <td style="text-align:center" width="175px">Anzahl A-Aktien</td> <td style="text-align:center" width="175px">Anzahl B-Aktien</td>
                                    </tr>
                                    <tr style="background: whitesmoke; font-size:10pt;">
                                        <td style="text-align:center" width="175px">{{ player.anzahlB }}</td> <td style="text-align:center" width="175">{{ player.anzahlA }}</td>
                                    </tr>
                                </table>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="card my-0" style="top: 20px; height: 520px" >
                    <div class="card-body"  style="height: 500px">
                        <h4 class="card-title" align="center" style="margin-bottom: .0rem">
                               Entscheidung
                        </h4>
                        <div id="Info2" style=" float:left;">
                            <p align="center">
                                Geben Sie nun die Verkaufs- und Kaufspreise in die untenliegenden Felder ein.
                            </p>
                                <div id="main" style="margin-left: -10px;">
                                    <div id="spaltelinks">
                                        <div class="card my-4" >
                                            <div class="card-body" style="height: 250px;" >
                                                <h4 class="card-title">
                                                    Handelsplatz A
                                                </h4>
                                                <table border="0" cellpadding="1" cellspacing="1">
                                                    <tr style="font-size:10pt;">
                                                        <td>{% formfield player.verkaufB label="Verkauf A:" %}</td>
                                                    </tr>
                                                    <tr style="font-size:10pt;">
                                                        <td>{% formfield player.kaufB label="Kauf A:"%}</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <div id="spalterechts">
                                        <div class="card my-4">
                                            <div class="card-body" style="height: 250px;">
                                                <h4 class="card-title">
                                                    Handelsplatz B
                                                </h4>
                                                <table border="0" cellpadding="1" cellspacing="1">
                                                    <tr style="font-size:10pt;">
                                                        <td>{% formfield player.verkaufA  label="Verkauf B:"%}</td>
                                                    </tr>
                                                    <tr style="font-size:10pt;">
                                                        <td>{% formfield player.kaufA label="Kauf B:"%}</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="clear"></div>
                                </div>
                        </div>
                    </div>


                    {% next_button %}
                </div>
            </div>


            <div class="col-md-4">
                <div class="card my-0">
                    <div class="card-body" style="height: 816px;">
                        {% include 'RepCostExperiment/comp_template/B.html' %}

                            <p>
                                <table align="center" style="width: 378px" >
                                    <tr style="font-size:10pt;">
                                        <th>Letzter Marktpreis B-Unternehmen </th>
                                    </tr>
                                    <tr style="background: whitesmoke; font-size:10pt;">
                                        <td style="text-align:center" width="350px">{% if subsession.round_number == 1 %}Noch kein Handel {% else %}{% if marktpreisA_alt == None %}Kein Handel{% else %}{{ marktpreisA_alt }}{% endif %}{% endif %}</td>
                                    </tr>
                                </table>
                            </p>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endif %}
<br>
<div class="container-fluid">
            <div class="col-md-12">
                    <div class="card-body" style="height: 100px;">
                        <div class="center">
                            <a class="button" href="#popup">Instruktionen anzeigen</a>
                            <div id="popup" class="overlay">
                                <div class="popup">
                                    <a class="close" href="#">&times;</a>
                                    <div class="content">
                                        <h4>Ablauf</h4>

                                        <p>
                                            In diesem Experiment sollen Sie auf einem fiktiven Kapitalmarkt Aktien kaufen und verkaufen, um so Ihre Auszahlung am Ende des Experiments zu optimieren.
                                        </p>

                                        <p>
                                            Das Experiment besteht insgesamt aus <b>zwei</b> vom Ablauf her identischen <b>Handels-Sequenzen</b> und einem anschließenden <b>Fragebogen</b>. Jede Sequenz besteht aus <b>XX&nbsp;Perioden</b>. Jede Periode unterteilt sich wiederum in
                                            eine <b>Handelsphase</b> und eine <b>Dividendenphase</b>.
                                        </p>
                                        <p>
                                            In jeder Handelsphase können Sie am Kapitalmarkt Aktien von zwei verschiedenen Unternehmen handeln, um so Ihr Portfolio (= Aktienbestand) zu optimieren. In jeder Dividendenphase erhalten Sie anschließend für jede Aktie in Ihrem Portfolio eine Auszahlung (= Dividende). Um welche Unternehmen es sich handelt und wie hoch die Dividenden sind, erfahren Sie im Punkt <i>Unternehmen und Dividenden</i>.
                                        </p>

                                        <p>
                                            Nachdem Sie die Instruktionen gelesen haben, müssen Sie einige Verständnisfragen beantworten.
                                        </p>

                                        <h4>Währung</h4>
                                        <p>
                                            Die Durchführung des Experiments erfolgt in einer <b>fiktiven Währung</b>, die wir <b>ECU</b> nennen. 1 ECU entspricht dabei 0,01 €. Ihre tatsächliche Vergütung wird am Ende der Studie in Euro umgerechnet.
                                        </p>

                                        <h4>Anfangsvermögen</h4>

                                        <p>
                                                Zu Beginn jeder Sequenz erhalten Sie von uns ein Vermögen in Höhe von XX ECU. Zusätzlich erhalten Sie für Ihr Portfolie jeweils xx Aktien der beiden Unternehmen.
                                        </p>

                                        <h4>Dividenden</h4>
                                        <p>
                                            Die Dividende eines Unternehemens wird durch einen Zufallsgenerator für jede Periode neu bestimmt. Insgesamt gibt es fünf mögliche Dividenden mit einer gleichen Eintrittswahrscheinlichkeit von jeweils 20 %.
                                            Informationen zu den Dividenden jedes Unternehmens finden Sie bei den Informationen zu jedem Unternehmen.
                                        </p>
                                        <p>
                                            <b>Beispiel:</b> Dividende pro Aktie: [10, 20, 30, 40, 50] ECU
                                        </p>
                                        <p>
                                            Die Dividende pro Aktie wird in jeder Periode für jedes Unternehmen neu bestimmt. Die Höhe der Dividende beträgt in diesem Beispiel 10, 20, 30, 40 <b>oder</b> 50 ECU.
                                            Sie wird mit Hilfe eines Zufallsgenerators bestimmt. Die Eintrittswahrscheinlichkeit ist für alle fünf Zustände gleich. So erhalten Sie beispielsweise mit einer Wahrscheinlichkeit von 20 % eine Dividende in Höhe von 30 ECU.
                                        </p>

                                        <h4>Markt</h4>
                                        <p>
                                            In diesem Experiment nehmen sie an einem fiktiven Kapitalmarkt teil. Neben Ihnen handeln noch X weitere Experimentteilnehmer an diesem Markt.
                                        </p>
                                        <p>
                                            In jeder Periode haben Sie in der Handelsphase die Möglichkeit Aktien von anderen Marktteilnehmern zu kaufen als auch an andere Marktteilnehmer zu verkaufen.
                                        </p>

                                        <h4>Kauf von Aktien</h4>
                                        <p>
                                            Um Aktien von anderen Marktteilnehmer zu kaufen, geben Sie in das Feld <b>Kauf</b> Ihre maximale Zahlungsbereitschaft für eine Aktie des entsprechenden Unternehmens ein.
                                            Möchten Sie in einer Periode keine Aktie kaufen, lassen Sie das Feld frei.
                                        </p>

                                        <h4>Verauf von Aktien</h4>
                                        <p>
                                               Um Aktien an andere Marktteilnehmer zu verkaufen, geben Sie in das Feld <b>Verkauf</b> den minimalen Preis ein, zum dem Sie bereit sind die Aktie zu verkaufen.
                                        </p>

                                        <h4>Ende der Handelsphase</h4>
                                        <p>
                                                Die Handelsphase endet spätestens nach <b>2 Minuten</b> automatisch. Sie haben jedoch die Möglichkeit schon vorher Ihre Eingaben zu bestätigen und somit die Handelsphase vorzeitig zu beenden. Klicken Sie dazu auf <i>Weiter</i>.
                                        </p>

                                        <h4>Ermittlung des Marktpreises</h4>

                                        <p>
                                               Im Anschluss an die Handelsphase werden für beide Unternehmen die Nachfragen und Angebote auf dem Markt ausgewertet. Dabei werden die Zahlungsbereitschaften für den Kauf absteigend und die Zahlungsforderungen für den Verkauf aufsteigend sortiert. Sie finden diese Übersicht für beide Märkte unten mittig auf dem Bildschirm in der Dividendenphase.
                                                Zur Veranschaulichung nutzen wir den Markt A aus der oben abgebildeten Dividendenphase. Es werden der Reihe nach die entstandenen Nachfrage- und Angebotspaare verglichen. Im ersten Paar möchte der Spieler 1 die Aktie für 4 ECU kaufen, während Spieler 2 bereit ist, diese für 2 ECU zu verkaufen. In diesem Fall findet ein Handel statt. Betrachten wir das nächste Nachfrage- und Angebotspaar. Spieler 3 ist bereit die Aktie ebenfalls für 4 ECU zu kaufen. Allerdings möchte Spieler 1 diese minimal für 5 ECU verkaufen. Dies bedeutet, dass zwischen diesen Spielern kein Handel stattfindet.
                                        </p>

                                        <p>
                                               Abschließend muss der Marktpreis berechnet werden, zu dem alle Transaktionen durchgeführt werden. Dafür wird als erstes das Handelspaar mit dem niedrigsten Nachfragepreis und höchsten Angebotspreis bestimmt, bei dem ein Handel stattfindet. Der Marktpreis ergibt sich als Mittelwert aus diesem Kaufpreis- und Verkaufspreispaar. Im Beispiel bedeutet dies, dass wir uns den Handel von Spieler 1 und 2 anschauen. Der Mittelwert aus dem Nachfragepreis (4 ECU) und aus dem Angebotspreis (2 ECU) beträgt 3 ECU, sodass die Aktie für 3 ECU gehandelt wird.
                                                Entsprechend kann es passieren, dass beispielsweise Ihr angegebener Kaufpreis zwar über dem Marktpreis liegt, jedoch kein weiterer Marktteilnehmer bereit ist zu diesem Preis zu verkaufen und somit der Käufer mit einer höheren oder der gleichen Kaufnachfrage die Aktie erhält.
                                        </p>

                                        <h4>Variable Vergütung</h4>
                                        <p>
                                                Ihre variable Vergütung entspricht dem Vermögen am Ende einer Sequenz. Ein Zufallsgenerator entscheidet, welches Vermögen der beiden Sequenzen ausgezahlt wird.
                                                <b>Es wird folglich nur eine Sequenz entlohnt!</b> Das Ergebnis der zufällig gezogenen Sequenz wird in Euro umgerechnet.
                                        </p>

                                        <br>
                                        {% include 'RepCostExperiment/includes/Popup.html' %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
 </div>
{% endblock %}